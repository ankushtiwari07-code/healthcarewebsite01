<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doctor Dashboard | HealthCare+</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
body{
  font-family:Poppins;
  margin:0;
  padding:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  background:linear-gradient(135deg,#1976d2,#0d47a1);
  transition:0.3s ease;
  color:#fff;
}
.dark{
  background:linear-gradient(135deg,#121212,#1e1e1e);
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px;
  background:rgba(0,0,0,0.2);
}
header h1{margin:0;font-size:24px;}
header button{
  padding:8px 14px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  font-weight:600;
}
main{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

/* APPOINTMENT CARD */
.appointment-card{
  background:rgba(255,255,255,0.9);
  color:#000;
  border-radius:16px;
  padding:20px;
  width:100%;
  max-width:450px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  margin-top:20px;
  transition:0.3s ease;
}
.dark .appointment-card{background:#2c2c2c;color:#fff;}
.appointment-card h3{margin:0 0 10px 0;font-size:20px;color:#1976d2;}
.appointment-card p{margin:6px 0;font-size:16px;}
.appointment-card button{
  margin-right:10px;
  padding:6px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
button.approve{background:#4CAF50;color:#fff;}
button.reject{background:#f44336;color:#fff;}
button.reschedule{background:#1976d2;color:#fff;}
button.save{background:#2196F3;color:#fff;}
button.cancelEdit{background:#9e9e9e;color:#fff;}

/* TOAST */
.toast{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#333;
  color:#fff;
  padding:12px 18px;
  border-radius:8px;
  opacity:0;
  transform:translateY(20px);
  transition:0.4s ease;
}
.toast.show{opacity:1;transform:translateY(0);}
.toast.success{background:#4CAF50;}
.toast.error{background:#f44336;}
</style>
</head>
<body>

<header>
  <h1>Doctor Dashboard</h1>
  <div>
    <button id="darkToggle">ðŸŒ™ Dark Mode</button>
    <button id="logoutBtn">Logout</button>
  </div>
</header>

<main>
  <p id="welcomeMsg">Welcome, Doctor</p>
  <div id="appointmentsList"></div>
</main>

<div id="toast" class="toast"></div>

<script>
// CHECK LOGIN
const doctor = JSON.parse(localStorage.getItem("loggedInUser"));
if(!doctor || doctor.role!=="doctor"){window.location.href="index.html";}

document.getElementById("welcomeMsg").innerText=`Welcome, Dr. ${doctor.name}!`;

// DARK MODE
const darkBtn = document.getElementById("darkToggle");
if(localStorage.getItem("darkMode")==="enabled"){document.body.classList.add("dark"); darkBtn.innerText="â˜€ Light Mode";}
darkBtn.addEventListener("click",()=>{
  document.body.classList.toggle("dark");
  if(document.body.classList.contains("dark")){localStorage.setItem("darkMode","enabled"); darkBtn.innerText="â˜€ Light Mode";}
  else{localStorage.setItem("darkMode","disabled"); darkBtn.innerText="ðŸŒ™ Dark Mode";}
});

// LOGOUT
document.getElementById("logoutBtn").addEventListener("click",()=>{
  localStorage.removeItem("loggedInUser");
  window.location.href="index.html";
});

// TOAST
function showToast(msg,type="success"){const t=document.getElementById("toast");t.innerText=msg;t.className="toast show "+type;setTimeout(()=>{t.className="toast";},3000);}

// DISPLAY APPOINTMENTS
function displayAppointments(){
  const appointments=JSON.parse(localStorage.getItem("appointments"))||[];
  const list=document.getElementById("appointmentsList");
  list.innerHTML="";
  const myAppts=appointments.filter(a=>a.doctor===doctor.name);
  if(myAppts.length===0){list.innerHTML="<p>No appointments yet.</p>";return;}
  myAppts.forEach((a,index)=>{
    const card=document.createElement("div");
    card.className="appointment-card";
    const statusText = a.status ? a.status : "Pending";
    card.innerHTML=`<h3>Appointment with ${a.patient}</h3>
                    <p><strong>Email:</strong> ${a.email}</p>
                    <p><strong>Date:</strong> ${a.date}</p>
                    <p><strong>Time:</strong> ${a.time}</p>
                    <p><strong>Status:</strong> ${statusText}</p>
                    <button class="approve">Approve</button>
                    <button class="reject">Reject</button>
                    <button class="reschedule">Reschedule</button>`;
    // APPROVE
    card.querySelector(".approve").addEventListener("click",()=>{
      a.status="Approved";
      localStorage.setItem("appointments",JSON.stringify(appointments));
      showToast(`Appointment approved`);
      displayAppointments();
    });
    // REJECT
    card.querySelector(".reject").addEventListener("click",()=>{
      if(confirm("Reject this appointment?")){
        appointments.splice(appointments.indexOf(a),1);
        localStorage.setItem("appointments",JSON.stringify(appointments));
        showToast("Appointment rejected","error");
        displayAppointments();
      }
    });
    // RESCHEDULE INLINE FORM
    card.querySelector(".reschedule").addEventListener("click",()=>{
      card.innerHTML=`<h3>Reschedule Appointment with ${a.patient}</h3>
        <input type="date" value="${a.date}" class="edit_date">
        <input type="time" value="${a.time}" class="edit_time">
        <button class="save">Save</button>
        <button class="cancelEdit">Cancel</button>`;
      card.querySelector(".save").addEventListener("click",()=>{
        const newDate = card.querySelector(".edit_date").value;
        const newTime = card.querySelector(".edit_time").value;
        if(!newDate||!newTime){showToast("Fill both fields","error"); return;}
        a.date=newDate; a.time=newTime; a.status="Pending"; // reset status when rescheduled
        localStorage.setItem("appointments",JSON.stringify(appointments));
        showToast("Appointment rescheduled","success");
        displayAppointments();
      });
      card.querySelector(".cancelEdit").addEventListener("click",()=>displayAppointments());
    });
    list.appendChild(card);
  });
}
displayAppointments();
</script>
</body>
</html>
